"use strict";!function(){jQuery(function(i){var t=null!=(e=window.wc_memberships_admin)?e:{},e=null!=(r=window.typenow)?r:"",r=null!=(r=window.pagenow)?r:"";if(window.WC_Memberships_Member_Modal_View=WC_Memberships_Modal_View.extend({render:function(){return WC_Memberships_Member_Modal_View.__super__.render.apply(this,arguments),this.$("#wc-memberships-member-modal-user-source").trigger("change"),i(document.body).trigger("wc-enhanced-select-init")},events:function(){return _.extend({},WC_Memberships_Member_Modal_View.__super__.events,{"change #wc-memberships-member-modal-user-source":"toggleSourceFields"})},setError:function(e){return this.$("#wc-memberships-member-modal-response").html('<div class="wc-memberships-modal-error"><span>'+e+"</span></div>")},clearError:function(){return this.$("#wc-memberships-modal-response").html("")},toggleSourceFields:function(e){var r,s;return this.clearError(),s=this.$("#wc-memberships-modal-select-existing-user"),r=this.$("#wc-memberships-modal-create-new-user"),"existing"===i(e.target).val()?(s.show(),r.hide()):(s.hide(),r.show())},createUser:function(e){var r=i.extend({},this.getNewUserData(),{action:"wc_memberships_create_user_for_membership",security:t.create_user_for_membership_nonce});return i.post(t.ajax_url,r,e)},getNewUserData:function(){var e=this.$("#wc-memberships-member-modal-password");return{username:this.$("#wc-memberships-member-modal-user-login").val(),email:this.$("#wc-memberships-member-modal-user-email").val(),first_name:this.$("#wc-memberships-member-modal-user-first-name").val(),last_name:this.$("#wc-memberships-member-modal-user-last-name").val(),password:e?e.val():""}},validateAndHandle:function(e,r){return!e||""===e||parseInt(e,10)<=0?(this.setError(t.i18n.please_select_user),this.unblock()):this.handleAction(e,r)},addButton:function(e){var r,s=this;return e.preventDefault(),r=this.$("#wc-memberships-member-modal-user-source").val(),this.clearError(),this.block(),"existing"===r?(e=this.$("#search_member_id").val(),this.validateAndHandle(e,r)):"new"===r?this.createUser(function(e){if(e&&e.data)return e.success?s.validateAndHandle(e.data,r):(s.setError(e.data),s.unblock())}):void 0}}),window.WC_Memberships_Modal_View_Add_User_Membership=WC_Memberships_Member_Modal_View.extend({template_id:"wc-memberships-modal-add-user-membership",handleAction:function(e){return i(document.body).trigger("wc_backbone_modal_response",[this._target,{user:e}]),window.location=t.new_membership_url+"&user="+e}}),window.WC_Memberships_Modal_View_Transfer_User_Membership=WC_Memberships_Member_Modal_View.extend({template_id:"wc-memberships-modal-transfer-user-membership",initialize:function(e){return this.user_id=parseInt(e.user_id,10),this.membership_id=parseInt(e.membership_id,10),WC_Memberships_Modal_View_Transfer_User_Membership.__super__.initialize.apply(this,arguments)},handleAction:function(r){var s=this,e={action:"wc_memberships_transfer_user_membership",security:t.transfer_user_membership_nonce,membership:this.membership_id,prev_user:this.user_id,new_user:r};return i.post(t.ajax_url,e,function(e){return e.success?(i(document.body).trigger("wc_backbone_modal_response",[s._target,{membership:s.membership_id,prev_user:s.user_id,new_user:r}]),location.reload()):(s.setError(e.data),s.unblock())})}}),"edit-wc_user_membership"!==r&&"wc_user_membership"!==r||i("div.wrap > a.page-title-action").on("click",function(e){return e.preventDefault(),new WC_Memberships_Modal_View_Add_User_Membership}),"wc_user_membership"===e)return i("#transfer-action a").on("click",function(e){return e.preventDefault(),e=i(this),new WC_Memberships_Modal_View_Transfer_User_Membership({user_id:e.data("user-id"),membership_id:e.data("membership-id")})})})}.call(void 0);